<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tinglin Garden Explorer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&amp;family=DM+Sans:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'DM Sans', sans-serif;
    }
    .font-serif-cn { font-family: 'Noto Serif SC', serif; }
    .font-body { font-family: 'DM Sans', sans-serif; }

    /* Jade green background */
    .jade-wash-bg {
      background: linear-gradient(135deg, #e8f5f1 0%, #d4ebe5 30%, #c0e0d8 60%, #e8f5f1 100%);
      position: relative;
    }
    .jade-wash-bg::before {
      content: '';
      position: absolute;
      inset: 0;
      background:
        radial-gradient(ellipse at 20% 50%, rgba(100,180,160,0.08) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 20%, rgba(100,160,140,0.06) 0%, transparent 40%),
        radial-gradient(ellipse at 50% 80%, rgba(80,140,120,0.05) 0%, transparent 45%);
      pointer-events: none;
    }

    /* Map styles */
    .garden-map {
      position: relative;
      width: 100%;
      height: 70vh; 
      border-radius: 16px; /* ÂúÜËßíÁ®çÂæÆÂä†Â§ß */
      overflow: hidden;
      background: #fff;
    }
    
    .content-iframe {
        width: 100%;
        height: 100%;
        border: none;
    }

    /* Memory cards */
    .memory-card {
      transition: transform 0.4s ease, box-shadow 0.4s ease;
      cursor: pointer;
      background: rgba(220,245,240,0.6) !important;
      border: 1px solid rgba(100,160,140,0.2) !important;
    }
    .memory-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(80,140,120,0.15);
      background: rgba(220,245,240,0.8) !important;
    }

    /* VR Viewer Container */
    .vr-viewer-container {
      position: relative;
      height: 600px; 
      overflow: hidden;
      border-radius: 16px;
      border: 1px solid rgba(100,160,140,0.2);
      background: #f0fdfa;
      box-shadow: inner 0 2px 10px rgba(0,0,0,0.05);
    }

    /* Stagger animations */
    .stagger-in {
      opacity: 0;
      transform: translateY(20px);
      animation: stagger-fade 0.6s ease forwards;
    }
    @keyframes stagger-fade {
      to { opacity: 1; transform: translateY(0); }
    }

    /* Tab indicator */
    .tab-indicator {
      transition: left 0.4s cubic-bezier(0.22, 1, 0.36, 1), width 0.4s cubic-bezier(0.22, 1, 0.36, 1);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
    }

    /* Scroll */
    .custom-scroll::-webkit-scrollbar { width: 6px; }
    .custom-scroll::-webkit-scrollbar-track { background: transparent; }
    .custom-scroll::-webkit-scrollbar-thumb { background: rgba(100,140,120,0.4); border-radius: 3px; }

    /* Compass */
    .compass-needle {
      animation: compass-wobble 4s ease-in-out infinite;
    }
    @keyframes compass-wobble {
      0%, 100% { transform: rotate(-5deg); }
      50% { transform: rotate(5deg); }
    }

    /* Floating particles */
    .particle {
      position: absolute;
      width: 2px;
      height: 2px;
      background: rgba(100,140,120,0.2);
      border-radius: 50%;
      animation: float-particle linear infinite;
    }
    @keyframes float-particle {
      0% { transform: translateY(0) translateX(0); opacity: 0; }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { transform: translateY(-200px) translateX(30px); opacity: 0; }
    }

    /* Jade text colors */
    .text-jade-dark { color: #2d5a52; }
    .text-jade-medium { color: #4a8076; }
    .text-jade-light { color: #6aab9f; }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app" class="jade-wash-bg h-full w-full overflow-auto custom-scroll">
   
   <div id="particles" class="absolute inset-0 pointer-events-none overflow-hidden" aria-hidden="true"></div>
   
   <header class="relative z-10 px-4 pt-6 pb-4 sm:px-8 sm:pt-10">
    <div class="flex items-center justify-between max-w-7xl mx-auto">
     <div>
      <!-- (1) ‰øÆÊîπÔºöTitle Â≠óÂè∑Âä†Â§ß text-3xl -> text-5xl -->
      <h1 id="app-title" class="font-serif-cn text-3xl sm:text-5xl font-bold text-jade-dark tracking-wide stagger-in" style="animation-delay: 0.1s">Between Map and Memory</h1>
      <!-- (1) ‰øÆÊîπÔºöSubtitle Â≠óÂè∑Âä†Â§ß text-sm -> text-xl -->
      <p id="app-subtitle" class="text-base sm:text-xl text-jade-medium mt-2 font-body stagger-in" style="animation-delay: 0.2s">Tinglin Garden Interactive Explorer</p>
     </div>
     
     <div class="stagger-in hidden sm:block" style="animation-delay: 0.3s" aria-hidden="true">
      <svg width="60" height="60" viewbox="0 0 44 44" class="compass-needle"><circle cx="22" cy="22" r="20" fill="none" stroke="rgba(100,140,120,0.3)" stroke-width="1.5" /> <circle cx="22" cy="22" r="16" fill="none" stroke="rgba(100,140,120,0.15)" stroke-width="0.5" /> <polygon points="22,6 25,22 22,20 19,22" fill="#4a8076" opacity="0.8" /> <polygon points="22,38 25,22 22,24 19,22" fill="rgba(100,140,120,0.3)" /> <circle cx="22" cy="22" r="2.5" fill="#4a8076" /> <text x="22" y="4" text-anchor="middle" fill="#4a8076" font-size="5" font-family="DM Sans">N</text></svg>
     </div>
    </div>
    
    <!-- (2) Welcome Text text-xs -> text-lg -->
    <p id="welcome-text" class="text-center text-jade-medium/70 text-lg sm:text-xl mt-4 max-w-6xl mx-auto stagger-in font-medium" style="animation-delay: 0.35s">Explore the cultural heritage of Kunshan</p>
    
    <!-- (3) Tabs  -->
    <nav class="mt-6 max-w-6xl mx-auto stagger-in flex justify-center" style="animation-delay: 0.4s" aria-label="Main navigation">
    
     <div class="relative inline-flex bg-white/40 rounded-full p-2 backdrop-blur-md border-2 border-jade-medium/30 shadow-md">
     
      <div id="tab-indicator" class="tab-indicator absolute top-2 bottom-2 bg-white rounded-full shadow-sm" style="left: 8px; width: calc(50% - 8px);"></div>
      
      <button id="tab-map" class="relative z-10 px-8 py-3 text-lg sm:text-xl font-bold rounded-full transition-colors text-jade-dark tracking-wide" onclick="switchTab('map')" aria-pressed="true"> <span id="map-tab-text">Map Âú∞Âõæ</span> </button> 
      <button id="tab-memory" class="relative z-10 px-8 py-3 text-lg sm:text-xl font-bold rounded-full transition-colors text-jade-medium/60 tracking-wide" onclick="switchTab('memory')" aria-pressed="false"> <span id="memory-tab-text">Memory ËÆ∞ÂøÜ</span> </button>
     </div>
    </nav>
   </header>

   <main class="relative z-10 px-4 sm:px-8 pb-12 max-w-7xl mx-auto">
    
    <!-- MAP VIEW -->
    <section id="view-map" class="mt-6" role="region" aria-label="Interactive garden map">
     <div class="garden-map border-2 border-jade-medium/20 shadow-xl">
       <iframe src="tinglin_map_fixed.html" class="content-iframe" title="Tinglin Garden Map"></iframe>
     </div>
     <div class="mt-4 text-center">
        
        <p class="text-base text-jade-medium/80 font-medium">Interact with the map above to explore locations.</p>
     </div>
    </section>

    <!-- MEMORY VIEW -->
    <section id="view-memory" class="mt-6 hidden" role="region" aria-label="Cultural memories and stories">
     
     <div id="memory-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- JS renders cards here -->
     </div>

     <div id="vr-container" class="hidden mt-8 animate-fade-in">
      
      <div class="flex items-center justify-between mb-4">
      
       <h2 id="vr-location-title" class="font-serif-cn text-2xl sm:text-3xl font-bold text-jade-dark"></h2>
       
       <button onclick="closeMemory()" class="px-5 py-2.5 bg-jade-medium/20 text-jade-dark text-sm sm:text-base font-bold rounded-full hover:bg-jade-medium/30 transition-colors flex items-center gap-2 border border-jade-medium/20">
         <span class="text-lg">‚Üê</span> Back to Stories
       </button>
      </div>
      
      <div class="vr-viewer-container shadow-lg border-2 border-jade-medium/20">
        <iframe id="memory-iframe" src="" class="content-iframe" title="Interactive Story"></iframe>
      </div>
      
      
      <p id="vr-description" class="mt-5 text-xl text-jade-medium/90 leading-relaxed font-serif-cn max-w-5xl mx-auto text-center font-medium"></p>
     
     </div>
    </section>
   </main>

   <!-- Footer -->
   <footer class="relative z-10 text-center pb-8 px-4">
    
    <p class="text-sm sm:text-base text-jade-medium/60 font-serif-cn font-medium">‰∫≠ÊûóÂõ≠ ¬∑ Kunshan, Jiangsu ¬∑ INFOSCI 301 Project</p>
   </footer>
  </div>

  <script>
    // === DATA (Consistent with previous request) ===
    const MEMORY_STORIES = [
      {
        id: 'story-guyanwu',
        icon: 'üìñ',
        title: 'The Scholar\'s Spirit',
        titleCn: '‰∫≠ÊûóÈ£éÈ™®',
        era: 'Ming-Qing Transition',
        summary: 'Everyone is responsible for the rise and fall of the world. \nÂ§©‰∏ãÂÖ¥‰∫°ÔºåÂåπÂ§´ÊúâË¥£„ÄÇ', 
        detail: 'Standing before the golden statue of Gu Yanwu, one feels the weight of history. The memorial hall traces his journey through scrolls and stone carvings, reminding us of the scholar who refused to bow to a new dynasty and dedicated his life to preserving cultural roots.',
        file: './VR/guyanwu/memory_guyanwu.html' 
      },
      {
        id: 'story-kunqu',
        icon: 'üé≠',
        title: 'Ancestor of All Dramas',
        titleCn: 'ÁôæÊàè‰πãÁ•ñ',
        era: 'Heritage ¬∑ Art',
        summary: 'The mother of Chinese opera, known for its watermill tunes. \nÊòÜÂ±±ËÖîË∞ÉÔºåÊ∞¥Á£®ÊÇ†Êâ¨„ÄÇ',
        detail: 'Inside the museum, a stone tablet proclaims Kunqu as the "Ancestor of All Dramas." From the exhibition hall to the rear stage, the perfect artistic charm of this centuries-old performance art still resonates today, influencing Peking Opera and many others.',
        file: './VR/kunqu/memory_kunqu.html'
      },
      {
        id: 'story-kunstone',
        icon: 'üíé',
        title: 'Jade in the Rough',
        titleCn: 'ÁéâÂá∫ÊòÜÂÜà',
        era: 'Geological Wonder',
        summary: 'Exquisite stones with poetic names like "Jade Rabbit" and "Star Nebula". \nÁé≤ÁèëÂâîÈÄèÔºåÊòÜÂ±±ÁâáÁéâ„ÄÇ',
        detail: 'As the plaque says, "Kunshan has jade, and jade is in its people." The museum displays exquisite Kunstones (one of the Three Treasures of Kunshan). These naturally formed stones feature holes and wrinkles that resemble clouds and snow.',
        file: './VR/kunstone/memory_kunstone.html'
      },
      {
        id: 'story-lotus',
        icon: 'ü™∑',
        title: 'Lotus and Literati',
        titleCn: 'Ëé≤Ëä±‰∏éÊñá‰∫∫',
        era: 'Song Dynasty ¬∑ 1070',
        summary: 'A symbol of purity rising unsullied from the mud. \nÂá∫Ê∑§Ê≥•ËÄå‰∏çÊüìÔºåÊøØÊ∏ÖÊ∂üËÄå‰∏çÂ¶ñ„ÄÇ',
        detail: 'Zhou Dunyi wrote his famous "On the Love of Lotus" here, declaring the flower a symbol of purity amid corruption. The lotus ponds of Tinglin Garden carry forward this millennium-old literary tradition, offering a space for quiet contemplation.',
        file: './VR/lotus/memory_lotus.html'
      },
      {
        id: 'story-luzhu',
        icon: 'üéã',
        title: 'Vows Amidst Bamboo',
        titleCn: 'Áø†Á´πËâØÁºò',
        era: 'Contemporary ¬∑ Happiness',
        summary: 'A rare garden marriage registry witnessing modern vows. \nÁ´πÊûóÂπΩÂæÑÔºåËßÅËØÅ‰ªäÁîüË™ìË®Ä„ÄÇ',
        detail: 'The "Luzhu (Green Bamboo) Courtyard" is a serene space that now witnesses modern love. As one of the few garden marriage registries in China, couples make appointments 2-30 days in advance via WeChat to tie the knot surrounded by the tranquility of nature.',
        file: './VR/luzhu/memory_luzhu.html'
      },
      {
        id: 'story-yangyu',
        icon: '‚òï',
        title: 'Garden of Leisure',
        titleCn: 'ÂÖªÈ¶ÄÈó≤ÊÉÖ',
        era: 'Classic & Modern',
        summary: 'Coffee aroma blending with ancient bonsai displays. \nÂè§Âõ≠ÁõÜÊôØÔºå‰∏îÈ•Æ‰∏ÄÊùØÂíñÂï°„ÄÇ',
        detail: 'Ascending the steps into Yangyu Garden, history meets modern lifestyle. Amidst traditional bonsai displays and ancient architecture, a modern coffee shop invites visitors to pause. It represents the perfect fusion of enjoying traditional aesthetics with contemporary leisure.',
        file: './VR/yangyu/memory_yangyu.html'
      },
     {
        id: 'story-stones',
        icon: '‚öñÔ∏è',
        title: 'Stones of Integrity',
        titleCn: 'ÂªâÁü≥Ë≠¶‰∏ñ',
        era: 'Moral Philosophy',
        summary: '"Fairness breeds clarity, Integrity breeds authority." \nÂÖ¨ÁîüÊòéÔºåÂªâÁîüÂ®Å„ÄÇ',
        detail: 'Two solemn stones stand as timeless warnings to officials. The inscriptions "Fairness breeds clarity" (ÂÖ¨ÁîüÊòé) and "Integrity breeds authority" (ÂªâÁîüÂ®Å) represent the upright moral code valued throughout Chinese history, reminding every visitor of the importance of character.',
        file: './VR/jiestone/memory_jiestone.html'
      },
     {
        id: 'story-dragon',
        icon: 'üêâ',
        title: 'The Dragon\'s Path',
        titleCn: 'Ê∏∏ÈæôÊàèÊ∞¥',
        era: 'Folklore ¬∑ Nature',
        summary: 'A zigzag bridge winding through water like a swimming dragon. \nÊõ≤ÂæÑÈÄöÂπΩÔºåÂÆõËã•Ê∏∏Èæô„ÄÇ',
        detail: 'Under a canopy of ancient trees, the zigzag bridge winds across the water like a swimming dragon. Looking around this 360¬∞ view, the winding paths, the lake water, and the hidden steps evoke the legend of the "Hidden Dragon" resting in the garden.',
        file: './VR/dragon/memory_dragon.html'
      },
     {
        id: 'story-martyrs',
        icon: 'üéóÔ∏è',
        title: 'Eternal Glory',
        titleCn: 'Âø†È≠ÇÊ∞∏È©ª',
        era: 'Revolutionary Era',
        summary: 'A solemn place of remembrance for heroes. \nÊ°ÉËä±Á∫¢Èõ®ÔºåÁ¢ßÊµ∑‰∏πÂøÉ„ÄÇ',
        detail: 'The monument stands tall, guarded by couplets carving the spirit of sacrifice: "Peach blossoms red as hero\'s blood, green seas and rosy clouds reflect the patriot\'s heart." It is a quiet sanctuary to honor those who gave their lives for the nation.',
        file: './VR/martyrs/memory_martyrs.html'
      }
    ];

    // === STATE ===
    let currentTab = 'map';

    // === CONFIG ===
    const defaultConfig = {
      app_title: 'Between Map and Memory',
      subtitle: 'Tinglin Garden Interactive Explorer',
      welcome_text: 'Explore the cultural heritage of Kunshan',
      map_tab_label: 'Map Âú∞Âõæ',
      memory_tab_label: 'Memory ËÆ∞ÂøÜ',
      background_color: '#e8f5f1',
      surface_color: '#c0e0d8',
      text_color: '#2d5a52'
    };

    // === TAB SWITCHING (With visual updates) ===
    function switchTab(tab) {
      currentTab = tab;
      const mapView = document.getElementById('view-map');
      const memoryView = document.getElementById('view-memory');
      const tabMap = document.getElementById('tab-map');
      const tabMemory = document.getElementById('tab-memory');
      const indicator = document.getElementById('tab-indicator');

      if (tab === 'map') {
        mapView.classList.remove('hidden');
        memoryView.classList.add('hidden');
        tabMap.classList.replace('text-jade-medium/60', 'text-jade-dark');
        tabMemory.classList.replace('text-jade-dark', 'text-jade-medium/60');
        tabMap.setAttribute('aria-pressed', 'true');
        tabMemory.setAttribute('aria-pressed', 'false');
        indicator.style.left = '8px'; // Adjust for larger padding
      } else {
        mapView.classList.add('hidden');
        memoryView.classList.remove('hidden');
        tabMemory.classList.replace('text-jade-medium/60', 'text-jade-dark');
        tabMap.classList.replace('text-jade-dark', 'text-jade-medium/60');
        tabMemory.setAttribute('aria-pressed', 'true');
        tabMap.setAttribute('aria-pressed', 'false');
        indicator.style.left = 'calc(50%)'; // Starts at 50%
        closeMemory(); 
      }
    }

    // === MEMORY GRID RENDERING (Large Font) ===
    function renderMemoryGrid() {
      const grid = document.getElementById('memory-grid');
      
      grid.innerHTML = MEMORY_STORIES.map((story, i) => `
        <article class="memory-card rounded-2xl overflow-hidden backdrop-blur-sm stagger-in shadow-md hover:shadow-xl" 
                 style="animation-delay: ${0.1 + i * 0.1}s" 
                 onclick="openMemory(${i})" 
                 tabindex="0" role="button" aria-label="Read about ${story.title}">
          <div class="p-8"> <!-- Âä†Â§ß padding -->
            <div class="flex items-start justify-between mb-5">
              <span class="text-5xl">${story.icon}</span> <!-- text-4xl -> text-5xl -->
              <span class="text-base text-jade-medium/70 font-serif-cn font-medium tracking-wide bg-white/50 px-3 py-1 rounded-md shadow-sm border border-jade-medium/10">${story.era}</span>
            </div>
            
            <h3 class="font-serif-cn text-3xl font-bold text-jade-dark mb-2 leading-tight tracking-tight">${story.title}</h3>
            <p class="font-serif-cn text-xl text-jade-medium/80 mb-5 font-bold">${story.titleCn}</p>
            
            <p class="text-lg text-jade-dark/80 leading-relaxed font-body border-t border-jade-medium/10 pt-4 font-medium">
                ${story.summary.replace(/\n/g, '<br/>')}
            </p>
            
            <div class="mt-8 flex items-center gap-3 text-base font-bold text-jade-medium hover:text-jade-dark transition-colors uppercase tracking-widest cursor-pointer">
              <span>Enter Story</span>
              <span class="text-xl">‚Üí</span>
            </div>
          </div>
        </article>
      `).join('');
    }

    // === MEMORY DETAIL LOGIC (Large Font) ===
    function openMemory(index) {
      const story = MEMORY_STORIES[index];
      const grid = document.getElementById('memory-grid');
      const container = document.getElementById('vr-container');
      const iframe = document.getElementById('memory-iframe');
      
      const titleEl = document.getElementById('vr-location-title');
      const descEl = document.getElementById('vr-description');

      grid.classList.add('hidden');
      container.classList.remove('hidden');

      // Title Text: text-3xl -> text-4xl/5xl
      titleEl.className = "font-serif-cn text-3xl sm:text-5xl font-bold text-jade-dark mb-2 tracking-wide"; 
      titleEl.innerText = `${story.icon} ${story.title} ¬∑ ${story.titleCn}`;
      
      // Desc Text: text-xl -> text-2xl
      descEl.className = "mt-8 text-xl sm:text-2xl text-jade-dark/80 leading-loose font-serif-cn max-w-5xl mx-auto font-medium"; 
      descEl.innerText = story.detail;

      iframe.src = story.file; 
      
      container.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function closeMemory() {
      const grid = document.getElementById('memory-grid');
      const container = document.getElementById('vr-container');
      const iframe = document.getElementById('memory-iframe');

      container.classList.add('hidden');
      grid.classList.remove('hidden');
      iframe.src = ''; 
    }

    // === PARTICLES ===
    function initParticles() {
      const container = document.getElementById('particles');
      for (let i = 0; i < 15; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        p.style.left = Math.random() * 100 + '%';
        p.style.top = (50 + Math.random() * 50) + '%';
        p.style.animationDuration = (6 + Math.random() * 8) + 's';
        p.style.animationDelay = Math.random() * 6 + 's';
        container.appendChild(p);
      }
    }

    // === ELEMENT SDK (Updated multipliers) ===
    function applyConfig(config) {
      const title = config.app_title || defaultConfig.app_title;
      const subtitle = config.subtitle || defaultConfig.subtitle;
      const welcome = config.welcome_text || defaultConfig.welcome_text;
      const mapLabel = config.map_tab_label || defaultConfig.map_tab_label;
      const memLabel = config.memory_tab_label || defaultConfig.memory_tab_label;
      const bgColor = config.background_color || defaultConfig.background_color;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const fontFamily = config.font_family ? `${config.font_family}, ` : '';
      const baseSize = config.font_size || 16; // ËôΩÁÑ∂ baseSize ÊòØ 16Ôºå‰ΩÜÊàë‰ª¨‰ºö‰πòÊõ¥Â§ßÁöÑÁ≥ªÊï∞

      document.getElementById('app-title').textContent = title;
      document.getElementById('app-subtitle').textContent = subtitle;
      document.getElementById('welcome-text').textContent = welcome;
      document.getElementById('map-tab-text').textContent = mapLabel;
      document.getElementById('memory-tab-text').textContent = memLabel;

      // Colors
      const app = document.getElementById('app');
      app.style.background = `linear-gradient(135deg, ${bgColor} 0%, ${surfaceColor} 50%, ${bgColor} 100%)`;
      
      document.getElementById('app-title').style.color = textColor;
      document.getElementById('app-subtitle').style.color = textColor + 'bb';
      document.getElementById('welcome-text').style.color = textColor + '80';

      // Fonts
      const serifStack = `${fontFamily}'Noto Serif SC', serif`;
      const bodyStack = `${fontFamily}'DM Sans', sans-serif`;
      
      document.getElementById('app-title').style.fontFamily = serifStack;
      document.getElementById('app-subtitle').style.fontFamily = bodyStack;
      document.getElementById('welcome-text').style.fontFamily = bodyStack;

      // (3)Font Size Scaling Multipliers
      // Title: base * 2.5 (PC: * 3.5)
      // Subtitle: base * 1.2
      // Welcome: base * 1.25
      document.getElementById('app-title').style.fontSize = `${baseSize * 3}px`;
      document.getElementById('app-subtitle').style.fontSize = `${baseSize * 1.5}px`;
      document.getElementById('welcome-text').style.fontSize = `${baseSize * 1.3}px`;
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig: defaultConfig,
        onConfigChange: async (config) => { applyConfig(config); },
        mapToCapabilities: (config) => ({
          recolorables: [
            { get: () => config.background_color || defaultConfig.background_color, set: (v) => { config.background_color = v; window.elementSdk.setConfig({ background_color: v }); } },
            { get: () => config.surface_color || defaultConfig.surface_color, set: (v) => { config.surface_color = v; window.elementSdk.setConfig({ surface_color: v }); } },
            { get: () => config.text_color || defaultConfig.text_color, set: (v) => { config.text_color = v; window.elementSdk.setConfig({ text_color: v }); } }
          ],
          borderables: [],
          fontEditable: { get: () => config.font_family || defaultConfig.font_family || '', set: (v) => { config.font_family = v; window.elementSdk.setConfig({ font_family: v }); } },
          fontSizeable: { get: () => config.font_size || defaultConfig.font_size || 16, set: (v) => { config.font_size = v; window.elementSdk.setConfig({ font_size: v }); } }
        }),
        mapToEditPanelValues: (config) => new Map([
          ['app_title', config.app_title || defaultConfig.app_title],
          ['subtitle', config.subtitle || defaultConfig.subtitle],
          ['welcome_text', config.welcome_text || defaultConfig.welcome_text],
          ['map_tab_label', config.map_tab_label || defaultConfig.map_tab_label],
          ['memory_tab_label', config.memory_tab_label || defaultConfig.memory_tab_label]
        ])
      });
    }

    // === INIT ===
    document.addEventListener('DOMContentLoaded', () => {
      renderMemoryGrid();
      initParticles();
      applyConfig(defaultConfig);
    });
  </script>
 </body>
</html>
